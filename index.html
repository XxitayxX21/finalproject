<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>××©×—×§ ×’×™×“×•×œ ×“×¨×§×•×Ÿ ××ª×§×“×</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
  body {
    margin: 0;
    background: linear-gradient(135deg, #0b0f26, #3a1a3a);
    font-family: 'Press Start 2P', cursive;
    color: #eee;
    text-align: center;
    user-select: none;
    overflow-x: hidden;
  }
  #start-screen, #game-screen, #battle-screen, #store-screen, #mini-game-screen, #story-screen {
    display: none;
    padding: 20px;
  }
  #start-screen.active, #game-screen.active, #battle-screen.active, #store-screen.active, #mini-game-screen.active, #story-screen.active {
    display: block;
  }
  h1, h2 {
    margin-bottom: 20px;
    color: #ffb347;
    text-shadow: 0 0 5px #ff6f00;
  }
  button {
    background: #ff6f00;
    border: none;
    color: white;
    font-size: 14px;
    padding: 15px 30px;
    margin: 10px;
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background: #ffa040;
  }
  #dragon-img {
    width: 200px;
    height: 200px;
    image-rendering: pixelated;
    transition: transform 0.3s ease;
  }
  #power-bar {
    width: 300px;
    height: 30px;
    background: #444;
    border-radius: 15px;
    margin: 20px auto;
    overflow: hidden;
    box-shadow: 0 0 10px #ffb347;
  }
  #power-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #ff9f00, #ff6f00);
    transition: width 0.5s ease;
  }
  #actions button {
    font-size: 16px;
    padding: 12px 20px;
    margin: 8px;
  }
  #score {
    font-size: 18px;
    margin: 10px 0;
    color: #fff;
    text-shadow: 0 0 5px #ffa040;
  }
  #message {
    font-size: 16px;
    margin: 15px 0;
    height: 40px;
  }
  /* Mini-game styles */
  #clicker-btn {
    background: #28a745;
    font-size: 20px;
    padding: 20px 40px;
    border-radius: 15px;
    box-shadow: 0 0 10px #28a745;
    user-select: none;
  }
  #potion {
    width: 60px;
    cursor: pointer;
    animation: float 3s ease-in-out infinite;
  }
  @keyframes float {
    0%, 100% { transform: translateY(0px);}
    50% { transform: translateY(-15px);}
  }
  /* Store styles */
  .store-item {
    background: #3a1a3a;
    border: 2px solid #ff6f00;
    border-radius: 15px;
    padding: 15px;
    margin: 10px auto;
    max-width: 300px;
  }
  .store-item button {
    margin-top: 10px;
    width: 100%;
    background: #ff6f00;
  }
  /* Battle styles */
  #battle-enemy-img {
    width: 150px;
    height: 150px;
    image-rendering: pixelated;
  }
  #battle-info {
    margin-top: 10px;
  }
  #health-bar-bg {
    width: 250px;
    height: 25px;
    background: #444;
    border-radius: 15px;
    margin: 10px auto;
  }
  #health-bar-fill {
    height: 100%;
    width: 100%;
    background: #ff4136;
    border-radius: 15px;
    transition: width 0.5s ease;
  }
  #dragon-health-bar-fill {
    background: #00cc44;
  }
  #story-text {
    max-width: 600px;
    margin: 20px auto;
    font-size: 16px;
    color: #ffa040;
    min-height: 120px;
  }
  #choice-buttons button {
    background: #ffa040;
    color: #3a1a3a;
    margin: 10px 5px;
  }
</style>
</head>
<body>

<!-- Start Screen -->
<div id="start-screen" class="active">
  <h1>ğŸ‰ ×‘×¨×•×›×™× ×”×‘××™× ×œ××©×—×§ ×’×™×“×•×œ ×“×¨×§×•×Ÿ!</h1>
  <button onclick="startGame()">×”×ª×—×œ ×œ×’×“×œ ××ª ×”×“×¨×§×•×Ÿ ×©×œ×š</button>
</div>

<!-- Story Screen -->
<div id="story-screen">
  <h2>×¡×™×¤×•×¨ ×”×”×ª×—×œ×”</h2>
  <div id="story-text"></div>
  <div id="choice-buttons"></div>
</div>

<!-- Main Game Screen -->
<div id="game-screen">
  <h2>×“×¨×§×•× ×š ×œ×™×“×š</h2>
  <img id="dragon-img" src="https://shorturl.at/4lpo7" alt="×“×¨×§×•×Ÿ ×§×˜×Ÿ" />
  <div id="power-bar"><div id="power-fill"></div></div>
  <div id="score">× ×§×•×“×•×ª: 0</div>
  <div id="message"></div>
  <div id="actions">
    <button onclick="performAction('feed')">ğŸ— ×”××›×™×œ</button>
    <button onclick="performAction('wash')">ğŸš¿ ×§×™×œ×—</button>
    <button onclick="performAction('water')">ğŸ’§ ×”×©×§×”</button>
    <button onclick="performAction('pet')">ğŸ– ×œ×™×˜×•×£</button>
    <button onclick="performAction('train')">âš” ××™××•×Ÿ</button>
    <button onclick="openMiniGame()">ğŸ¯ ××ª×’×¨ ×§×œ×™×§×™×</button>
    <button onclick="openStore()">ğŸ›’ ×—× ×•×ª ×©×™×§×•×™×™×</button>
    <button onclick="startBattle()">âš”ï¸ ×§×¨×‘ ×‘×•×¡</button>
  </div>
</div>

<!-- Mini Game Screen -->
<div id="mini-game-screen">
  <h2>××ª×’×¨ ×§×œ×™×§×™× - ×œ×—×¥ ×›××” ×©×™×•×ª×¨ ×‘×ª×•×š 10 ×©× ×™×•×ª!</h2>
  <button id="clicker-btn" onclick="clickButton()">×œ×—×¥ ×›××Ÿ!</button>
  <div id="timer">×–××Ÿ ×©× ×•×ª×¨: 10</div>
  <div id="click-count">×§×œ×™×§×™×: 0</div>
  <button onclick="exitMiniGame()">×—×–×•×¨ ×œ××©×—×§</button>
</div>

<!-- Store Screen -->
<div id="store-screen">
  <h2>×—× ×•×ª ×”×©×™×§×•×™×™×</h2>
  <div class="store-item">
    <div>×©×™×§×•×™ ×‘×¨×™××•×ª (+20 × ×§×•×“×•×ª)</div>
    <button onclick="buyPotion('health', 30)">×§× ×” ×‘-30 × ×§×•×“×•×ª</button>
  </div>
  <div class="store-item">
    <div>×©×™×§×•×™ ××™××•×Ÿ (+15 × ×§×•×“×•×ª ××™××•×Ÿ)</div>
    <button onclick="buyPotion('training', 40)">×§× ×” ×‘-40 × ×§×•×“×•×ª</button>
  </div>
  <div class="store-item">
    <div>×©×™×§×•×™ ×§×¡× (××’×“×™×œ × ×§×•×“×•×ª ×§×œ×™×§×™×)</div>
    <button onclick="buyPotion('magic', 50)">×§× ×” ×‘-50 × ×§×•×“×•×ª</button>
  </div>
  <button onclick="exitStore()">×—×–×•×¨ ×œ××©×—×§</button>
</div>

<!-- Battle Screen -->
<div id="battle-screen">
  <h2>×§×¨×‘ ××•×œ ×”×‘×•×¡ ×”××—×¨×•×Ÿ!</h2>
  <div>
    <img id="dragon-battle-img" src="https://shorturl.at/afTZf" alt="×“×¨×§×•×Ÿ ×§×¨×‘×™" />
    <div id="battle-info">
      <div>×‘×¨×™××•×ª ×“×¨×§×•×Ÿ: <span id="dragon-health">100</span></div>
      <div id="health-bar-bg"><div id="dragon-health-bar-fill"></div></div>
      <div>×‘×¨×™××•×ª ×‘×•×¡: <span id="boss-health">100</span></div>
      <div id="health-bar-bg"><div id="boss-health-bar-fill"></div></div>
    </div>
  </div>
  <button onclick="playerAttack()">×ª×§×•×£!</button>
  <button onclick="exitBattle()">×‘×¨×— ××”×§×¨×‘</button>
  <div id="battle-message"></div>
</div>

<audio id="grow-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="click-sound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
<audio id="attack-sound" src="https://actions.google.com/sounds/v1/impacts/sword_hit.ogg"></audio>
<audio id="boss-hit-sound" src="https://actions.google.com/sounds/v1/impacts/metal_thud.ogg"></audio>

<script>
  // ××©×ª× ×™× ×›×œ×œ×™×™×
  let score = 0;
  let actionsDone = 0;
  let dragonStage = 0; // 0 - ×§×˜×Ÿ, 1 - ×‘×™× ×•× ×™, 2 - ×’×“×•×œ, 3 - ×‘×•×¡
  let trainingPoints = 0;
  let magicActive = false;

  // ×“×¨×§×•×Ÿ, ×‘×¨×™××•×ª
  let dragonHealth = 100;
  let bossHealth = 100;
  const maxDragonHealth = 100;
  const maxBossHealth = 100;

  // ××œ×× ×˜×™×
  const startScreen = document.getElementById('start-screen');
  const gameScreen = document.getElementById('game-screen');
  const dragonImg = document.getElementById('dragon-img');
  const powerFill = document.getElementById('power-fill');
  const scoreElement = document.getElementById('score');
  const messageElement = document.getElementById('message');
  const growSound = document.getElementById('grow-sound');
  const clickSound = document.getElementById('click-sound');
  const attackSound = document.getElementById('attack-sound');
  const bossHitSound = document.getElementById('boss-hit-sound');

  // ××¡×›×™× × ×•×¡×¤×™×
  const miniGameScreen = document.getElementById('mini-game-screen');
  const storeScreen = document.getElementById('store-screen');
  const battleScreen = document.getElementById('battle-screen');
  const storyScreen = document.getElementById('story-screen');
  const storyText = document.getElementById('story-text');
  const choiceButtons = document.getElementById('choice-buttons');

  // ×¤×¨×˜×™ ×§×¨×‘
  const dragonHealthSpan = document.getElementById('dragon-health');
  const bossHealthSpan = document.getElementById('boss-health');
  const dragonHealthBar = document.getElementById('dragon-health-bar-fill');
  const bossHealthBar = document.getElementById('boss-health-bar-fill');
  const battleMessage = document.getElementById('battle-message');

  // --------------------------------
  // ×”×ª×—×œ×ª ×”××©×—×§
  function startGame() {
    startScreen.classList.remove('active');
    storyScreen.classList.add('active');
    showStoryIntro();
  }

  // ×¡×™×¤×•×¨ ×¤×ª×™×—×” ×¢× ×‘×—×™×¨×•×ª
  const storyLines = [
    {
      text: "×œ×¤× ×™ ×©× ×™× ×¨×‘×•×ª, ×‘××™ ×§×¡×•×, × ×•×œ×“ ×“×¨×§×•×Ÿ ×§×˜×Ÿ ×•×—××•×“. ×”×•× ×–×§×•×§ ×œ×¢×–×¨×ª×š ×œ×’×“×•×œ ×•×œ×”×¤×•×š ×œ×“×¨×§×•×Ÿ ×”××™××ª× ×™ ×©×›×•×œ× ×™×¤×—×“×• ××× ×•!",
      choices: [
        { text: "×§×— ××•×ª×• ×œ××™××•×Ÿ ×§×©×”", effect: () => { trainingPoints += 5; nextStory(); } },
        { text: "×ª×Ÿ ×œ×• ××”×‘×” ×•×˜×™×¤×•×—", effect: () => { score += 10; nextStory(); } }
      ]
    },
    {
      text: "×‘××”×œ×š ×”××¡×¢, ××ª×” ×¤×•×’×© ××›×©×£ ×©××¦×™×¢ ×œ×š ×©×™×§×•×™×™×. ×”×× ×ª×§× ×” ×©×™×§×•×™×™× ××• ×ª×¡×ª××š ×¢×œ ×¢×¦××š?",
      choices: [
        { text: "×§× ×” ×©×™×§×•×™×™× ×‘×—× ×•×ª", effect: () => { openStore(); } },
        { text: "×”××©×š ×‘×œ×™ ×©×™×§×•×™×™×", effect: () => { nextStory(); } }
      ]
    },
    {
      text: "×”×“×¨×§×•×Ÿ ×©×œ×š ×’×“×œ ×•×¦×¨×™×š ×œ×××Ÿ ××•×ª×• ×œ×§×¨×‘×•×ª! ××ª×” ××•×›×Ÿ ×œ××ª×’×¨ ×”×¨××©×•×Ÿ?",
      choices: [
        { text: "×›×Ÿ, ××ª×—×™×œ ××ª×’×¨ ×§×œ×™×§×™×", effect: () => { openMiniGame(); } },
        { text: "×œ×, ×× ×™ ×¨×•×¦×” ×œ×”×ª×—×™×œ ×‘×’×™×“×•×œ", effect: () => { enterGameScreen(); } }
      ]
    }
  ];
  let currentStoryIndex = 0;

  function showStoryIntro() {
    storyText.textContent = storyLines[currentStoryIndex].text;
    choiceButtons.innerHTML = '';
    storyLines[currentStoryIndex].choices.forEach(choice => {
      const btn = document.createElement('button');
      btn.textContent = choice.text;
      btn.onclick = () => {
        choice.effect();
      };
      choiceButtons.appendChild(btn);
    });
  }
  function nextStory() {
    currentStoryIndex++;
    if (currentStoryIndex < storyLines.length) {
      showStoryIntro();
    } else {
      enterGameScreen();
    }
  }
  function enterGameScreen() {
    storyScreen.classList.remove('active');
    gameScreen.classList.add('active');
    updateGameUI();
  }

  // --------------------------------
  // ×¤×•× ×§×¦×™×•×ª ×’×™×“×•×œ ×”×“×¨×§×•×Ÿ ×•×”×¤×¢×•×œ×•×ª
  function performAction(action) {
    let msg = "";
    switch(action) {
      case "feed":
        score += 5 + trainingPoints;
        msg = "×”××›×œ×ª ××ª ×”×“×¨×§×•×Ÿ! × ×§×•×“×•×ª × ×•×¡×¤×•×ª ×¢×œ ××™××•×Ÿ: " + trainingPoints;
        break;
      case "wash":
        score += 3;
        msg = "×§×™×œ×—×ª ××ª ×”×“×¨×§×•×Ÿ, ×”×•× ××¨×™×— × ×”×“×¨!";
        break;
      case "water":
        score += 4;
        msg = "×”×©×§×ª ××ª ×”×“×¨×§×•×Ÿ, ×”×•× ××¨×’×™×© ×˜×•×‘!";
        break;
      case "pet":
        score += 2;
        msg = "×œ×™×˜×¤×ª ××ª ×”×“×¨×§×•×Ÿ, ×”×•× ×××•×©×¨!";
        break;
      case "train":
        trainingPoints += 2;
        msg = "××™×× ×ª ××ª ×”×“×¨×§×•×Ÿ! ××™××•×Ÿ ××©×¤×¨ × ×§×•×“×•×ª ×‘×¢×ª×™×“.";
        break;
    }
    messageElement.textContent = msg;
    score = Math.max(score, 0);
    updateGameUI();
  }

  function updateGameUI() {
    scoreElement.textContent = `× ×§×•×“×•×ª: ${score}`;
    let percent = Math.min((score / 100) * 100, 100);
    powerFill.style.width = percent + "%";

    // ×©×“×¨×•×’ ×”×“×¨×§×•×Ÿ ×œ×¤×™ × ×§×•×“×•×ª
    if (score >= 300 && dragonStage < 3) {
      dragonStage = 3; // ××¦×‘ ×‘×•×¡
      dragonImg.src = "https://shorturl.at/afTZf"; // ×“×¨×§×•×Ÿ ××™××ª× ×™
      messageElement.textContent = "×“×¨×§×•× ×š ×”×¤×š ×œ×“×¨×§×•×Ÿ ××™××ª× ×™! ××•×›×Ÿ ×œ×§×¨×‘ ×”×‘×•×¡!";
      growSound.play();
    } else if (score >= 150 && dragonStage < 2) {
      dragonStage = 2; // ×’×“×•×œ
      dragonImg.src = "https://shorturl.at/bCGR5"; // ×“×¨×§×•×Ÿ ×‘×™× ×•× ×™
      messageElement.textContent = "×“×¨×§×•× ×š ×’×“×œ ×•×”×ª×—×–×§!";
      growSound.play();
    } else if (score >= 50 && dragonStage < 1) {
      dragonStage = 1; // ×§×˜×Ÿ-×‘×™× ×•× ×™
      dragonImg.src = "https://shorturl.at/eoXY2"; // ×“×¨×§×•×Ÿ ×§×˜×Ÿ-×‘×™× ×•× ×™
      messageElement.textContent = "×“×¨×§×•× ×š ××ª×¤×ª×— ×™×¤×”!";
      growSound.play();
    }
  }

  // --------------------------------
  // ××ª×’×¨ ×§×œ×™×§×™× (Mini Game)
  let clickCount = 0;
  let timeLeft = 10;
  let clickInterval;

  function openMiniGame() {
    gameScreen.classList.remove('active');
    miniGameScreen.classList.add('active');
    clickCount = 0;
    timeLeft = 10;
    document.getElementById('click-count').textContent = `×§×œ×™×§×™×: ${clickCount}`;
    document.getElementById('timer').textContent = `×–××Ÿ ×©× ×•×ª×¨: ${timeLeft}`;
    clickInterval = setInterval(() => {
      timeLeft--;
      document.getElementById('timer').textContent = `×–××Ÿ ×©× ×•×ª×¨: ${timeLeft}`;
      if (timeLeft <= 0) {
        clearInterval(clickInterval);
        finishMiniGame();
      }
    }, 1000);
  }
  function clickButton() {
    clickCount++;
    clickSound.play();
    document.getElementById('click-count').textContent = `×§×œ×™×§×™×: ${clickCount}`;
  }
  function finishMiniGame() {
    messageElement.textContent = `×¡×™×™××ª ××ª ××ª×’×¨ ×”×§×œ×™×§×™× ×¢× ${clickCount} ×§×œ×™×§×™×!`;
    score += clickCount * (magicActive ? 2 : 1); // ×©×™×§×•×™ ×§×¡× ××’×“×™×œ ×§×œ×™×§×™×
    updateGameUI();
  }
  function exitMiniGame() {
    miniGameScreen.classList.remove('active');
    gameScreen.classList.add('active');
  }

  // --------------------------------
  // ×—× ×•×ª ×©×™×§×•×™×™×
  function openStore() {
    gameScreen.classList.remove('active');
    storeScreen.classList.add('active');
  }
  function buyPotion(type, cost) {
    if (score < cost) {
      alert('××™×Ÿ ×œ×š ××¡×¤×™×§ × ×§×•×“×•×ª ×œ×§× ×•×ª ××ª ×”×©×™×§×•×™!');
      return;
    }
    score -= cost;
    switch(type) {
      case 'health':
        dragonHealth = Math.min(dragonHealth + 20, maxDragonHealth);
        messageElement.textContent = "×©×™×§×•×™ ×‘×¨×™××•×ª ×”×•×—×œ! ×”×‘×¨×™××•×ª ×©×œ×š ×¢×•×œ×”.";
        break;
      case 'training':
        trainingPoints += 15;
        messageElement.textContent = "×©×™×§×•×™ ××™××•×Ÿ ×”×•×—×œ! ××™××•×Ÿ ×”×“×¨×§×•×Ÿ ×”×©×ª×¤×¨.";
        break;
      case 'magic':
        magicActive = true;
        messageElement.textContent = "×©×™×§×•×™ ×§×¡× ×”×•×—×œ! × ×§×•×“×•×ª ×”×§×œ×™×§×™× ××•×›×¤×œ×•×ª.";
        break;
    }
    updateGameUI();
  }
  function exitStore() {
    storeScreen.classList.remove('active');
    gameScreen.classList.add('active');
    updateGameUI();
  }

  // --------------------------------
  // ×§×¨×‘ ×‘×•×¡
  function startBattle() {
    if (dragonStage < 3) {
      alert('×¢×œ×™×š ×œ×’×“×œ ××ª ×”×“×¨×§×•×Ÿ ×œ×¤×—×•×ª ×œ×“×¨×’×” 3 ×œ×¤× ×™ ×”×§×¨×‘!');
      return;
    }
    gameScreen.classList.remove('active');
    battleScreen.classList.add('active');
    dragonHealth = maxDragonHealth;
    bossHealth = maxBossHealth;
    updateBattleUI();
    battleMessage.textContent = "×§×¨×‘ ×”×—×œ!";
  }
  function updateBattleUI() {
    dragonHealthSpan.textContent = dragonHealth;
    bossHealthSpan.textContent = bossHealth;
    dragonHealthBar.style.width = (dragonHealth / maxDragonHealth) * 100 + '%';
    bossHealthBar.style.width = (bossHealth / maxBossHealth) * 100 + '%';
  }
  function playerAttack() {
    if (bossHealth <= 0 || dragonHealth <= 0) return;
    attackSound.play();

    // ×“×¨×§×•×Ÿ ×ª×•×§×£
    let playerDamage = 10 + trainingPoints;
    bossHealth -= playerDamage;
    bossHealth = Math.max(0, bossHealth);
    bossHitSound.play();

    // ×‘×•×¡ ×ª×•×§×£ ×‘×—×–×¨×” ×‘××§×¨××™
    if (bossHealth > 0) {
      let bossDamage = Math.floor(Math.random() * 15) + 5;
      dragonHealth -= bossDamage;
      dragonHealth = Math.max(0, dragonHealth);
    }

    updateBattleUI();

    if (bossHealth <= 0) {
      battleMessage.textContent = "× ×™×¦×—×ª ××ª ×”×‘×•×¡! ×“×¨×§×•× ×š ×”×•× ×”××’×“×”!";
      score += 500;
      updateGameUI();
    } else if (dragonHealth <= 0) {
      battleMessage.textContent = "×”×¤×¡×“×ª ×‘×§×¨×‘! ×ª×ª×××Ÿ ×¢×•×“ ×•× ×¡×” ×©×•×‘.";
    } else {
      battleMessage.textContent = `×”×ª×§×¤×ª ×•× ×¤×’×¢×ª! ×“×¨×§×•×Ÿ ×¤×’×¢ ×‘${playerDamage}, ×”×‘×•×¡ ×¤×’×¢ ×‘${dragonHealth < maxDragonHealth ? maxDragonHealth - dragonHealth : 0}`;
    }
  }
  function exitBattle() {
    battleScreen.classList.remove('active');
    gameScreen.classList.add('active');
    updateGameUI();
  }

</script>
</body>
</html>
